G³ówne zadanie Rozproszonej Jednostki Pomiarowej (HUB) to dokonywanie pomiaru wielkoœci fizycznych mierzonych przez czujniki rozmieszczone w bolidzie. Za standard analogowego sygna³u wejœciowego przyjêto 0-12V. \newline
Uk³ad Jednostki Pomiarowej sk³ada siê z 3 odseparowanych galwanicznie czêœci: pomiarowej, mikrokontrolerowej i transmisji CAN.\newline
Uk³ad realizuj¹cy dzia³anie Jednostki to STM32f103, zapewniaj¹c peryferia pomiarowe jak i komunikacyjne.
\subsection{Mikrokontroler}
Mikrokontroler STM32f103 pochodzi z rodziny uk³adów o rdzeniu Cortex\texttrademark-M3, dostêpny od paru lat na rynku, sprawdza siê w rozwi¹zaniach wymagaj¹cych ma³ego i prostego kontrolera. Szereg peryferiów w które wyposa¿ony jest ten uk³ad stawia go w kategorii uniwersalnoœci nie osi¹galnej przez inne uk³ady na rynku tej klasy. Najwa¿niejsze peryferia wykorzystane w Hubie to:\newline
\begin{itemize}
	\item Dwa 12 bitowe przetworniki analogowo-cyfrowe, potrafi¹ce obs³u¿yæ do 16 kana³ów
	\item Interfejs komunikacyjny CAN 2.0B
\end{itemize}
Uk³ad dostarcza tak¿e 7 timerów sprzêtowych, które mog¹ pracowaæ w wielu zaawansowanych trybach. Do wykonywania pomiarów z okreœlonym próbkowaniem wystarcz¹ podstawowe tryby dzia³ania dostarczonych timerów.
\subsection{Zasilanie}
\subsection{Separacja sygna³ów analogowych}
Dokonywanie pomiaru odbywa siê za pomoc¹ kana³ów ADC mikrokontrolera. Przyjêty przez nas standard napiêcia wymusza na nas sprowadzenie poziomów napiêæ sygna³u do zakresu pracy przetwornika ADC. Podczas projektowania rozpatrywano 3 rozwi¹zania:\newline
\begin{itemize}
	\item Rezystancyjny dzielnik napiêcia
	\item Izolacja sygna³ów analogowych przez zewnêtrzny uk³ad ADC
	\item Izolacja sygna³ów analogowych na uk³adzie IL300
\end{itemize}
Najprostszym rozwi¹zaniem jest rezystancyjny dzielnik napiêcia jest to czwórnik który zapewnia uzyskanie okreœlonego stosunku pomiêdzy napiêciem wejœciowym a wyjœciowym\cite{book:SE}. Rozwi¹zanie tego typu w ¿aden sposób nie zabezpiecza przed podaniem zbyt wysokiego napiêcia oraz wymusza aby sygna³ analogowy by³ mierzony wzglêdem masy Jednostki Pomiarowej. \newline
\begin  {figure} [h] 
\centering
\includegraphics[width=0.75\textwidth]{figures/ADS1100.png}
\caption{Separacja analogowa przy u¿yciu uk³adu ADS1100}
\label{fig:ADS}
\end {figure}

Nastêpn¹ metod¹ separacji, któr¹ brano pod uwagê by³o wykorzystanie zewnêtrznego uk³adu ADC, który przesy³a³by dane po odseparowanej magistrali danych. Zaprojektowane rozwi¹zanie widaæ na \hyperref[fig:ADS]{Rysunku~\ref*{fig:ADS}}. Zosta³o odrzucone, poniewa¿ przetwornik wymaga³ zasilania o napiêciu $5V$ co komplikowa³o uk³ad po stronie nieseparowanej. Dodatkowo takie podejœcie podra¿a³o znacz¹co uk³ad. Rozwi¹zanie to sprawdzi³o by siê w aplikacjach w których zale¿y nam na wysokiej dok³adnoœci pomiarów bez wprowadzania przek³amañ, które pojawiaj¹ siê przy separacji analogowej.\newline
Ostatnia opcja, która zosta³a wybrana to separacja przy u¿yciu uk³adu IL300. Uk³ad IL300 posiada jedn¹ diodê nadawcz¹ i dwie diody odbiorcze. Konfiguracja taka pozwala stworzyæ po stronie pierwotnej, sprzê¿enie przez jedn¹ z diod odbiorczych, steruj¹ce pr¹dem diody nadawczej. Kompensuje to nieliniowoœæ œwiecenia diody nadawczej wzglêdem jej pr¹du. Na stronie wtórnej uk³adu IL300 mamy drug¹ diodê odbiorcz¹, której pr¹d jest zale¿ny liniowo od pr¹du diody odbiorczej po stronie pierwotnej\cite{manual:IL300}.
\begin  {figure} [h] 
\centering
\includegraphics[width=0.75\textwidth]{figures/Il300.png}
\caption{Separacja analogowa przy u¿yciu uk³adu IL300}
\label{fig:IL300}
\end {figure}

\subsection{Obs³uga magistrali CAN}
Zadaniem jednostki pomiarowej jest wysy³anie zebranych informacji do g³ównego komputera pok³adowego. Nie musi ona odbieraæ ¿adnych wiadomoœci, st¹d maska równa jest 0x0000000 (wiêcej o maskach w \hyperref[ssec:filtry]{Sekcji~\ref*{ssec:filtry}: Filtry akceptacyjne}).\\
Realizacja fizyczna transceivera CAN przedstawiona jest na \hyperref[fig:transceiver]{Rysunku~\ref*{fig:transceiver}}.\\
Ka¿da wiadomoœæ odpowiada innemu kana³owi przetwornika analogowo-cyfrowego. Czas próbkowania definiuje siê w pliku \textit{defines.h}. Ka¿dy HUB posiada swój unikalny adres, który zdefiniowany jest w pliku \textit{defines.h} (wiêcej o adresowaniu w \hyperref[ssec:adresowanie]{Sekcji~\ref*{ssec:adresowanie}: Przestrzeñ adresowa CAN} i na \hyperref[fig:adresowanie]{Rysunku~\ref*{fig:adresowanie}}).